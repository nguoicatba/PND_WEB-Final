@using PND_WEB.ViewModels
@model QuotationsEditDeleteDetailController

@{
    ViewData["Title"] = "Details";
}
@{
    bool isReadOnly = Model.Quotation.Qsatus == "Hoàn thành" || Model.Quotation.Qsatus == "Đã hủy";
}

@{
    var staffNameAttr = isReadOnly
        ? new Dictionary<string, object> { { "class", "form-control" }, { "readonly", "readonly" } }
        : new Dictionary<string, object> { { "class", "form-control" } };
}
<h1>Details</h1>

<table class="table table-bordered">
    <tr>
        <th>Mã báo giá:</th>
        <td>@Model.Quotation.QuotationId</td>
    </tr>
    <tr>
        <th>Trạng thái:</th>
        <td>@Model.Quotation.Qsatus</td>
    </tr>
    <tr>
        <th>Nhân viên:</th>
        <td>@Model.Quotation.StaffName</td>
    </tr>
    <tr>
        <th>Khách hàng:</th>
        <td>@Model.Quotation.CusTo</td>
    </tr>
    <tr>
        <th>Liên hệ khách:</th>
        <td>@Model.Quotation.CusContact</td>
    </tr>
    <tr>
        <th>Ngày tạo:</th>
        <td>@Model.Quotation.Qdate?.ToString("dd/MM/yyyy")</td>
    </tr>
    <tr>
        <th>Hiệu lực:</th>
        <td>@Model.Quotation.Valid?.ToString("dd/MM/yyyy")</td>
    </tr>
    <tr>
        <th>Điều khoản:</th>
        <td>@Model.Quotation.Term</td>
    </tr>
    <tr>
        <th>Hàng hóa:</th>
        <td>@Model.Quotation.Commodity</td>
    </tr>
    <tr>
        <th>Khối lượng:</th>
        <td>@Model.Quotation.Vol</td>
    </tr>
    <tr>
        <th>Điểm đi (POL):</th>
        <td>@Model.Quotation.Pol</td>
    </tr>
    <tr>
        <th>Điểm đến (POD):</th>
        <td>@Model.Quotation.Pod</td>
    </tr>
</table>

<h3>Chi tiết chi phí</h3>
@{
    float totalAmount = 0f;
}
<div class="card">
    <div class="card-body">
        @if (!isReadOnly)
           {
        <p>
            <a asp-action="CreateCharges" asp-route-id="@Model.Quotation.QuotationId" class="btn btn-primary btn-xs">Create New</a>
        </p>
        }
        <table class="table nowrap border" id="datatable1">
            <thead class="bg bg-secondary">
                <tr>
                    @if (!isReadOnly)
                    {
                    <th></th>
                    }
                    <th>Tên phí</th>
                    <th>Số lượng</th>
                    <th>Đơn vị</th>
                    <th>Đơn giá</th>
                    <th>Tiền tệ</th>
                    <th>Ghi chú</th>
                    <th>Thành tiền</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.QuotationsCharges)
        {
            float rate = item.Rate.HasValue ? (float)item.Rate.Value : 0f;
            float quantity = (float)item.Quantity;
            float amount = quantity * rate;
            totalAmount += amount;
            <tr>
                        @if (!isReadOnly)
                        {
                        <td>
                            <a asp-action="EditCharges" asp-route-id="@item.ChargeId" class="btn btn-primary btn-xs"><i class="fa fa-edit"></i></a>
                            <a asp-action="DeleteCharges" asp-route-id="@item.ChargeId" class="btn btn-danger btn-xs"><i class="fa fa-trash"></i></a>
                        </td>
                        }
                <td>@item.ChargeName</td>
                <td>@item.Quantity</td>
                <td>@item.Unit</td>
                <td>@item.Rate?.ToString("N2")</td>
                <td>@item.Currency</td>
                <td>@item.Notes</td>
                <td>
                    @if (item.Rate.HasValue)
                    {
                        @(((double)item.Quantity * item.Rate.Value).ToString("N2"));
                    }
                </td>
            </tr>
        }
    </tbody>
    <tfoot>
        <tr>
            <td colspan="6" class="text-end"><strong>Tổng cộng:</strong></td>
            <td><strong>@totalAmount.ToString("N2")</strong></td>
        </tr>
    </tfoot>
</table>
</div>
</div>

<a asp-controller="Quotations" asp-action="Index">Back to List</a>